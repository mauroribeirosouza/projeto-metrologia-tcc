<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Form View -->
    <record id="view_equipamento_form" model="ir.ui.view">
        <field name="name">metrology.equipamento.form</field>
        <field name="model">metrology.equipamento</field>
        <field name="arch" type="xml">
            <form string="Instrumento de Medição">
                <header>
                    <field name="status_metrologico" widget="statusbar" 
                           statusbar_visible="conforme,vencido,nao_conforme"/>
                </header>
        <sheet>
                    <div class="oe_button_box" name="button_box">
            <button name="action_view_calibracoes" type="object"
                class="oe_stat_button" icon="fa-check-square-o">
                            <field name="calibracao_ids" widget="statinfo" 
                                   string="Calibrações"/>
            </button>
            <button name="action_print_history" type="object" string="Exportar Histórico" class="oe_highlight" icon="fa-file-pdf-o"/>
                    </div>
                    <group>
                        <group name="identificacao" string="Identificação">
                            <field name="codigo"/>
                            <field name="tag"/>
                            <field name="nome"/>
                            <field name="tipo"/>
                        </group>
                        <group name="status" string="Status e Calibração">
                            <field name="ultima_calibracao"/>
                            <field name="proxima_calibracao"/>
                            <field name="dias_para_vencimento"/>
                            <field name="frequencia_calibracao"/>
                        </group>
                    </group>
                    <group>
                        <group name="fabricante" string="Dados do Fabricante">
                            <field name="fabricante"/>
                            <field name="modelo"/>
                            <field name="numero_serie"/>
                        </group>
                        <group name="localizacao" string="Localização">
                            <field name="localizacao"/>
                            <field name="centro_custo"/>
                            <field name="responsavel_id"/>
                        </group>
                    </group>
                    <group string="Especificações Técnicas">
                        <field name="faixa_medicao"/>
                        <field name="resolucao"/>
                        <field name="incerteza_maxima"/>
                        <field name="erro_maximo_admissivel"/>
                    </group>
                    <notebook>
                        <page string="Histórico de Calibrações">
                            <field name="calibracao_ids" readonly="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="data_calibracao"/>
                                    <field name="data_validade"/>
                                    <field name="resultado"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Não Conformidades">
                            <field name="nao_conformidade_ids"/>
                        </page>
                        <page string="Observações">
                            <field name="observacoes"/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Tree View -->
    <record id="view_equipamento_tree" model="ir.ui.view">
        <field name="name">metrology.equipamento.tree</field>
        <field name="model">metrology.equipamento</field>
        <field name="arch" type="xml">
            <tree string="Instrumentos de Medição" 
                  decoration-danger="status_metrologico=='vencido'" 
                  decoration-warning="dias_para_vencimento&lt;30"
                  decoration-success="status_metrologico=='conforme'">
                <field name="codigo"/>
                <field name="tag"/>
                <field name="nome"/>
                <field name="tipo"/>
                <field name="localizacao"/>
                <field name="ultima_calibracao"/>
                <field name="proxima_calibracao"/>
                <field name="dias_para_vencimento"/>
                <field name="status_metrologico"/>
            </tree>
        </field>
    </record>

    <!-- Kanban View -->
    <record id="view_equipamento_kanban" model="ir.ui.view">
        <field name="name">metrology.equipamento.kanban</field>
        <field name="model">metrology.equipamento</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_dashboard">
                <field name="status_metrologico"/>
                <field name="dias_para_vencimento"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="tag"/>
                                    </strong>
                                </div>
                                <span t-attf-class="badge badge-pill #{record.status_metrologico.raw_value == 'conforme' ? 'badge-success' : 'badge-danger'}">
                                    <field name="status_metrologico"/>
                                </span>
                            </div>
                            <div class="o_kanban_record_body">
                                <field name="nome"/>
                                <div class="text-muted">
                                    Próxima calibração: <field name="proxima_calibracao"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_equipamento_search" model="ir.ui.view">
        <field name="name">metrology.equipamento.search</field>
        <field name="model">metrology.equipamento</field>
        <field name="arch" type="xml">
            <search string="Buscar Equipamentos">
                <field name="tag"/>
                <field name="nome"/>
                <field name="codigo"/>
                <field name="tipo"/>
                <field name="localizacao"/>
                <filter string="Conformes" name="conforme" 
                        domain="[('status_metrologico', '=', 'conforme')]"/>
                <filter string="Vencidos" name="vencido" 
                        domain="[('status_metrologico', '=', 'vencido')]"/>
                <filter string="Vence em 30 dias" name="alerta_30" 
                        domain="[('dias_para_vencimento', '&lt;=', 30), ('dias_para_vencimento', '&gt;', 0)]"/>
                <group expand="0" string="Agrupar por">
                    <filter string="Tipo" name="group_tipo" context="{'group_by': 'tipo'}"/>
                    <filter string="Status" name="group_status" context="{'group_by': 'status_metrologico'}"/>
                    <filter string="Localização" name="group_localizacao" context="{'group_by': 'localizacao'}"/>
                </group>
            </search>
        </field>
    </record>



    <!-- Action -->
    <record id="action_equipamento" model="ir.actions.act_window">
        <field name="name">Instrumentos de Medição</field>
        <field name="res_model">metrology.equipamento</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="search_view_id" ref="view_equipamento_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Cadastre um novo instrumento de medição
            </p>
        </field>
    </record>
</odoo>
